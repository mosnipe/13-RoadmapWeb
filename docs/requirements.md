# リリースノート＆開発ロードマップ Webアプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的
これまで開発してきた機能（リリースノート）と、これから開発する機能（開発ロードマップ）を一覧化し、視覚的に管理・共有できるWebアプリケーションを構築する。

### 1.2 主要機能
- **リリースノート管理**: 
  - GitHub APIから直接取得（認証必要、リアルタイム同期）
  - または、GitHubからエクスポートしたファイルを読み込み（認証不要、オフライン対応）
- **開発ロードマップ管理**: Excel/CSVから読み込んだ将来の開発計画を表示
- **データ統合表示**: 2つのデータソースを統合してタイムライン形式で表示
- **エクスポート機能**: PNG/PDF形式でのダウンロード

---

## 2. 機能要件

### 2.1 GitHub連携機能

#### 2.1.1 認証・接続管理
- **機能**: GitHub APIへの認証と接続管理
- **詳細**:
  - **パブリックリポジトリ**: 認証なしでもアクセス可能（レート制限: 60リクエスト/時）
  - **プライベートリポジトリ**: 認証必須（レート制限: 5,000リクエスト/時）
  - 認証方法:
    - Personal Access Token (PAT) を使用
    - OAuth認証（将来拡張）
  - トークンの安全な保存:
    - ブラウザのローカルストレージに暗号化して保存
    - または、ユーザーが毎回入力（セキュリティ重視の場合）
  - 接続状態の確認と表示
- **UI要素**:
  - 認証トークン入力フィールド（マスク表示）
  - 接続テストボタン
  - 接続状態の表示（Connected/Disconnected/Error）
  - トークンの保存/削除オプション

#### 2.1.2 リポジトリ管理
- **機能**: GitHubリポジトリの選択と管理
- **詳細**:
  - 複数リポジトリの選択可能
  - 認証済みユーザーのリポジトリ一覧を自動取得
  - パブリック/プライベートリポジトリの両方に対応
  - リポジトリの追加・削除
  - リポジトリの検索機能
- **UI要素**:
  - ドロップダウンでリポジトリ選択
  - リポジトリタイプの表示（Public/Private）
  - 接続状態の表示（Connected/Disconnected）

#### 2.1.3 ブランチフィルター
- **機能**: 特定のブランチのみを対象にリリースノートを生成
- **詳細**:
  - ブランチパターンの指定（例: `main`, `release/*`）
  - 複数パターンの追加・削除
  - ワイルドカード対応
- **UI要素**:
  - タグ形式でブランチパターン表示
  - パターン追加ボタン

#### 2.1.4 データ取得・同期
- **機能**: GitHubからプルリクエスト/イシュー情報を取得
- **詳細**:
  - 自動同期機能
  - 手動リフレッシュ機能
  - 最終同期時刻の表示
  - 取得データの変換・整形

#### 2.1.5 データマッピング
- **機能**: GitHubデータを内部データ構造にマッピング
- **マッピング項目**:
  - Title: PR/Issueのタイトル
  - Status: マージ状態（Merged/Open/Closed）
  - Assignee: 担当者
  - Date: マージ日/作成日
  - Source: ソース識別子（GH-XXX形式）

#### 2.1.6 エクスポートファイル読み込み（代替方法）
- **機能**: GitHubから事前にエクスポートしたファイルを読み込む
- **目的**: 
  - 認証不要でデータを読み込める
  - レート制限の心配がない
  - オフラインでも使用可能
  - セキュリティリスクが低い（トークン不要）
- **対応ファイル形式**:
  - **JSON形式**: GitHub APIのレスポンス形式
    - プルリクエスト配列: `[{id, title, state, merged_at, user, ...}]`
    - イシュー配列: `[{id, title, state, created_at, assignee, ...}]`
  - **CSV形式**: GitHub CLI (`gh`) でエクスポートしたCSV
    - カラム: `number,title,state,author,created_at,merged_at,url` 等
  - **GitHub CLI JSON**: `gh pr list --json` や `gh issue list --json` の出力
- **データ取得方法（ユーザー側）**:
  - **GitHub CLI使用**:
    ```bash
    # プルリクエストをJSONでエクスポート
    gh pr list --repo owner/repo --state all --json number,title,state,author,createdAt,mergedAt,url > prs.json
    
    # イシューをJSONでエクスポート
    gh issue list --repo owner/repo --state all --json number,title,state,assignees,createdAt,closedAt,url > issues.json
    ```
  - **GitHub API直接使用**:
    - ブラウザやcurlでAPIを叩いてJSONを保存
    - 認証が必要な場合は一度だけトークンを使用
  - **手動エクスポート**:
    - GitHubのWeb UIから手動でCSV/JSONをエクスポート（可能な場合）
- **ファイルアップロード**:
  - ドラッグ&ドロップ対応
  - ファイル選択ダイアログ
  - 複数ファイルの同時アップロード（PRとIssueを別々に）
  - ファイル形式の自動検出（JSON/CSV）
- **データ解析**:
  - JSON形式の自動パース
  - CSV形式のパース（PapaParse等を使用）
  - データ構造の自動検出とマッピング
  - エラーハンドリング（不正な形式、必須フィールド欠損等）
- **UI要素**:
  - ファイルアップロードエリア
  - アップロード済みファイル一覧
  - データプレビュー（読み込み前の確認）
  - エラーメッセージ表示
  - 「API接続」と「ファイル読み込み」の切り替えタブ
- **メリット**:
  - 認証不要
  - レート制限なし
  - オフライン対応
  - セキュリティリスク低減
  - データのスナップショット保存が可能
- **デメリット**:
  - 手動でのエクスポート作業が必要
  - リアルタイム同期ができない
  - ファイル管理が必要

---

### 2.2 Excel/CSV連携機能（ロードマップ用）

#### 2.2.1 ファイルアップロード
- **機能**: Excel/CSVファイルのアップロード（将来の開発計画用）
- **詳細**:
  - ドラッグ&ドロップ対応
  - ファイル選択ダイアログ
  - ファイル形式検証（.xlsx, .xls, .csv）
  - ファイルサイズ制限（例: 10MB）
  - アップロード済みファイルの表示
- **注意**: GitHubのエクスポートファイル（CSV/JSON）とは別の機能

#### 2.2.2 カラムマッピング設定
- **機能**: CSV/Excelのカラムを内部データ構造にマッピング
- **マッピング対象カラム**:
  - **Title**: タスク名/機能名
  - **Status**: ステータス（In Progress/Backlog/Completed等）
  - **Assignee**: 担当者
  - **Date**: リリース予定日/期限
- **UI要素**:
  - ドロップダウンでカラム選択
  - マッピング設定の保存
  - マッピング設定のリセット

#### 2.2.3 データ解析・変換
- **機能**: アップロードされたファイルを解析し、内部形式に変換
- **詳細**:
  - CSV/Excelのパース
  - データ型の自動判定
  - エラーハンドリング（不正なデータ形式等）

---

### 2.3 データ統合・表示機能

#### 2.3.1 データプレビュー
- **機能**: マッピング設定後のデータをプレビュー表示
- **詳細**:
  - テーブル形式での表示
  - ソース識別（GitHub/CSV）
  - リアルタイムプレビュー更新
  - ページネーション（大量データ対応）

#### 2.3.2 ロードマップ表示
- **機能**: タイムライン形式でリリースノートとロードマップを統合表示
- **表示要素**:
  - タイムライン軸（年月表示）
  - 過去のリリース（GitHub由来）
  - 将来のリリース予定（CSV/Excel由来）
  - カテゴリ別のグループ化（新機能/改善/修正等）
  - ステータスバッジ表示

#### 2.3.3 フィルタリング・検索
- **機能**: 表示データの絞り込み
- **詳細**:
  - ソース別フィルター（GitHub/CSV）
  - ステータス別フィルター
  - 日付範囲フィルター
  - キーワード検索

---

### 2.4 エクスポート機能

#### 2.4.1 PNGエクスポート
- **機能**: ロードマップをPNG画像としてダウンロード
- **詳細**:
  - 高解像度対応
  - カスタマイズ可能なサイズ
  - ダークモード/ライトモード選択

#### 2.4.2 PDFエクスポート
- **機能**: ロードマップをPDFとしてダウンロード
- **詳細**:
  - 複数ページ対応
  - メタデータ設定（タイトル、作成日等）
  - 印刷最適化

---

### 2.5 UI/UX機能

#### 2.5.1 ダークモード
- **機能**: ライト/ダークモードの切り替え
- **詳細**:
  - ユーザー設定の保存
  - システム設定の自動検出

#### 2.5.2 レスポンシブデザイン
- **機能**: 各種デバイスに対応
- **詳細**:
  - モバイル/タブレット/デスクトップ対応
  - サイドバーの折りたたみ（モバイル）

#### 2.5.3 ナビゲーション
- **機能**: ページ間の移動
- **ページ構成**:
  - Dashboard（統合表示）
  - Integrations（設定画面）
  - Roadmaps（ロードマップ一覧）
  - Release Notes（リリースノート一覧）
  - Team（チーム管理）

---

## 3. 非機能要件

### 3.1 パフォーマンス
- データ読み込み時間: 3秒以内
- ページ遷移: 1秒以内
- エクスポート生成: 10秒以内（100件程度のデータ）

### 3.2 セキュリティ
- **GitHub APIトークンの安全な保存**:
  - ローカルストレージに保存する場合は暗号化推奨
  - または、セッションごとの入力（トークンを保存しない）
  - トークンは決してサーバーに送信しない（クライアント側のみで使用）
- **認証トークンの権限**:
  - 最小権限の原則（必要なスコープのみ）
  - 推奨スコープ: `repo` (プライベートリポジトリアクセス), `public_repo` (パブリックリポジトリのみ)
- アップロードファイルの検証
- XSS対策
- CSRF対策
- GitHub APIのレート制限対策（エラーハンドリング）

### 3.3 ブラウザ対応
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

### 3.4 データ保存
- 設定情報のローカルストレージ保存
- マッピング設定のエクスポート/インポート

---

## 4. 技術要件

### 4.1 フロントエンド
- **フレームワーク**: React / Vue.js / またはVanilla JS
- **スタイリング**: Tailwind CSS
- **アイコン**: Material Icons
- **フォント**: Inter, Noto Sans JP

### 4.2 バックエンド（必要に応じて）
- **API**: GitHub API連携
- **ファイル処理**: Excel/CSVパーサー
- **エクスポート**: html2canvas, jsPDF等のライブラリ

### 4.3 外部API・データソース
- **GitHub API** (直接接続方式): 
  - **認証方法**:
    - Personal Access Token (PAT) - 推奨
    - OAuth App（将来拡張）
  - **アクセス制限**:
    - パブリックリポジトリ: 認証なし可（60リクエスト/時）
    - プライベートリポジトリ: 認証必須（5,000リクエスト/時）
  - **エンドポイント**:
    - `/repos/{owner}/{repo}/pulls` - プルリクエスト取得
    - `/repos/{owner}/{repo}/issues` - イシュー取得
    - `/user/repos` - ユーザーのリポジトリ一覧（認証時）
    - `/user` - 認証済みユーザー情報
  - **レート制限**:
    - 認証なし: 60リクエスト/時
    - 認証あり: 5,000リクエスト/時
    - レート制限エラーの適切なハンドリング

- **GitHubエクスポートファイル** (ファイル読み込み方式):
  - **対応形式**:
    - JSON: GitHub APIレスポンス形式、GitHub CLI JSON出力
    - CSV: GitHub CLI CSV出力、手動エクスポート
  - **データソース**:
    - GitHub CLI (`gh`) でエクスポートしたファイル
    - GitHub APIで取得したJSONを保存したファイル
    - 手動でエクスポートしたCSV/JSONファイル
  - **メリット**:
    - 認証不要
    - レート制限なし
    - オフライン対応
    - セキュリティリスク低減

### 4.4 ライブラリ候補
- **CSV/Excel解析**: 
  - PapaParse (CSV)
  - SheetJS / xlsx (Excel)
- **JSON解析**:
  - ネイティブ `JSON.parse()` (基本的なJSON)
  - 必要に応じてカスタムパーサー（GitHub API形式対応）
- **エクスポート**:
  - html2canvas (PNG)
  - jsPDF (PDF)
  - react-pdf (React使用時)
- **日付処理**: date-fns / dayjs
- **ファイル処理**:
  - FileReader API (ブラウザネイティブ)
  - ドラッグ&ドロップ: HTML5 Drag and Drop API

---

## 5. データ構造

### 5.1 内部データ構造
```typescript
interface RoadmapItem {
  id: string;
  source: 'github' | 'csv' | 'excel';
  title: string;
  status: 'Merged' | 'In Progress' | 'Backlog' | 'Completed' | 'Open' | 'Closed';
  assignee: string;
  date: string; // ISO 8601形式
  category?: string;
  description?: string;
  sourceId?: string; // GH-XXX や CSV行番号
}
```

### 5.2 設定データ構造
```typescript
interface IntegrationSettings {
  github: {
    // API接続方式
    connectionType: 'api' | 'file'; // 接続方式の選択
    token?: string; // 暗号化して保存、または保存しない
    tokenStored: boolean; // トークンが保存されているか
    repositories: string[];
    branchFilters: string[];
    lastSync?: string;
    authenticated: boolean;
    
    // ファイル読み込み方式
    exportedFiles?: {
      prs?: File; // プルリクエストのエクスポートファイル
      issues?: File; // イシューのエクスポートファイル
      lastLoaded?: string; // 最終読み込み日時
    };
  };
  csv: {
    file?: File;
    columnMapping: {
      title: string;
      status: string;
      assignee: string;
      date: string;
    };
  };
}
```

### 5.3 GitHubエクスポートファイルのデータ構造
```typescript
// GitHub CLI JSON形式（プルリクエスト）
interface GitHubPRExport {
  number: number;
  title: string;
  state: 'OPEN' | 'CLOSED' | 'MERGED';
  author: {
    login: string;
  };
  createdAt: string; // ISO 8601
  mergedAt?: string; // ISO 8601
  url: string;
  baseRefName?: string; // マージ先ブランチ
  headRefName?: string; // マージ元ブランチ
}

// GitHub CLI JSON形式（イシュー）
interface GitHubIssueExport {
  number: number;
  title: string;
  state: 'OPEN' | 'CLOSED';
  assignees: Array<{
    login: string;
  }>;
  createdAt: string; // ISO 8601
  closedAt?: string; // ISO 8601
  url: string;
}

// GitHub APIレスポンス形式（プルリクエスト）
interface GitHubAPIPRResponse {
  id: number;
  number: number;
  title: string;
  state: 'open' | 'closed';
  merged: boolean;
  user: {
    login: string;
  };
  created_at: string;
  merged_at: string | null;
  html_url: string;
  base: {
    ref: string;
  };
  head: {
    ref: string;
  };
}
```

---

## 6. 画面構成

### 6.1 統合設定画面（Integrations）
- **GitHub連携セクション**:
  - 接続方式の選択タブ（「API接続」/「ファイル読み込み」）
  - **API接続方式**:
    - 認証トークン入力
    - リポジトリ選択
    - ブランチフィルター
    - 同期ボタン
  - **ファイル読み込み方式**:
    - ファイルアップロードエリア（ドラッグ&ドロップ対応）
    - プルリクエストファイル（JSON/CSV）
    - イシューファイル（JSON/CSV）
    - アップロード済みファイル一覧
    - ファイル削除ボタン
- Excel/CSV連携セクション（ロードマップ用）
- データプレビューテーブル
- 保存・確定ボタン

### 6.2 ロードマップ表示画面
- ヘッダー（タイトル、エクスポートボタン、ダークモード切り替え）
- タイムライン表示
  - 年月マーカー
  - 過去のリリース（GitHub）
  - 将来のリリース予定（CSV/Excel）
  - カテゴリ別グループ化
- フッター（編集リンク、コピーライト）

### 6.3 その他の画面
- Dashboard: 統合ビュー
- Roadmaps: ロードマップ一覧
- Release Notes: リリースノート一覧
- Team: チーム管理（将来拡張）

---

## 7. 実装優先順位

### Phase 1: 基本機能
1. プロジェクトセットアップ
2. 基本UI実装（ナビゲーション、レイアウト）
3. CSV/Excelアップロード機能
4. カラムマッピング機能
5. データプレビュー表示

### Phase 2: GitHub連携
**方式A: API接続方式**
1. GitHub API認証機能（PAT入力・保存）
2. リポジトリ一覧取得（認証済みユーザーのリポジトリ）
3. リポジトリ選択機能
4. ブランチフィルター機能
5. データ取得・変換機能（プライベート/パブリック対応）
6. レート制限エラーハンドリング

**方式B: エクスポートファイル読み込み方式（代替・推奨）**
1. ファイルアップロード機能（JSON/CSV対応）
2. ファイル形式の自動検出
3. GitHub CLI JSON形式のパース
4. GitHub API JSON形式のパース
5. CSV形式のパース（GitHub CLI CSV出力対応）
6. データ構造の自動マッピング
7. エラーハンドリング（不正形式、必須フィールド欠損等）
8. UI: 「API接続」と「ファイル読み込み」の切り替えタブ

**推奨実装順序**: 方式Bを先に実装（認証不要で簡単）、その後方式Aを実装

### Phase 3: ロードマップ表示
1. タイムライン表示実装
2. データ統合表示
3. フィルタリング機能

### Phase 4: エクスポート機能
1. PNGエクスポート
2. PDFエクスポート

### Phase 5: 改善・最適化
1. パフォーマンス最適化
2. エラーハンドリング強化
3. UI/UX改善

---

## 8. デザイン仕様

### 8.1 カラーパレット
- **Primary**: `#13ec5b` (編集画面) / `#1e3a8a` (ロードマップ画面)
- **Background Light**: `#f6f8f6` / `#ffffff`
- **Background Dark**: `#102216` / `#0f172a`
- **Text**: `#1e293b` (light) / `#f1f5f9` (dark)

### 8.2 タイポグラフィ
- **Font Family**: Inter, Noto Sans JP
- **Heading**: Bold (700-900)
- **Body**: Regular (400-500)

### 8.3 コンポーネント
- カード: 角丸 `rounded-xl`
- ボタン: Primary/Secondaryスタイル
- バッジ: ステータス表示用
- タイムライン: 縦線 + 円形マーカー

---

## 9. 今後の拡張可能性

- 複数プロジェクト管理
- チームメンバー管理
- 通知機能
- コメント機能
- バージョン管理
- API提供

---

## 10. 制約事項・注意点

### 10.1 GitHub API関連
- **レート制限**:
  - 認証なし: 60リクエスト/時（パブリックリポジトリのみ）
  - 認証あり: 5,000リクエスト/時（プライベートリポジトリもアクセス可能）
  - レート制限に達した場合の適切なエラーメッセージとリトライ機能
- **プライベートリポジトリアクセス**:
  - Personal Access Tokenが必要
  - トークンの安全な管理が必須
  - トークンはクライアント側でのみ使用（サーバーに送信しない）
- **CORS制限**:
  - GitHub APIはCORSをサポートしているが、ブラウザからの直接アクセスに注意
  - 必要に応じてプロキシサーバーの検討

### 10.1.1 エクスポートファイル読み込み方式（推奨）
- **メリット**:
  - 認証不要（セキュリティリスク低減）
  - レート制限なし
  - オフライン対応可能
  - データのスナップショット保存が可能
  - プライベートリポジトリでも安全にデータを取得可能
- **デメリット**:
  - 手動でのエクスポート作業が必要
  - リアルタイム同期ができない
  - ファイル管理が必要
  - データ更新のたびに再エクスポートが必要
- **推奨ユースケース**:
  - プライベートリポジトリを使用している場合
  - セキュリティを重視する場合
  - 定期的なスナップショットで十分な場合
  - オフライン環境で作業する場合

### 10.2 その他
- 大容量ファイルのアップロード時のパフォーマンス
- ブラウザ互換性（特にエクスポート機能）
- データの永続化方法（ローカルストレージ vs バックエンド）
- トークンの保存方法（セキュリティと利便性のバランス）