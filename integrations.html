<!DOCTYPE html>
<html class="light" lang="ja">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>データ統合・マッピング設定 - Mappin</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <link href="src/css/common.css" rel="stylesheet"/>
    <link href="src/css/layout.css" rel="stylesheet"/>
    <link href="src/css/components.css" rel="stylesheet"/>
    <link href="src/css/integrations.css" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2563eb", // 青基調
                        "accent": "#f97316", // オレンジ
                        "background-light": "#ffffff",
                        "background-dark": "#0f172a",
                    },
                    fontFamily: {
                        "display": ["Inter"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
</head>
<body class="page-body">
    <div class="page-container">
        <!-- SideNavBar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <span class="material-symbols-outlined font-bold">account_tree</span>
                    </div>
                    <div>
                        <h1 class="sidebar-logo-text">Mappin</h1>
                        <p class="sidebar-version">v1.0.2</p>
                    </div>
                </div>
                <nav class="sidebar-nav">
                    <a class="sidebar-nav-item" href="index.html">
                        <span class="material-symbols-outlined">home</span>
                        <span class="text-sm font-medium sidebar-nav-text">ダッシュボード</span>
                    </a>
                    <a class="sidebar-nav-item sidebar-nav-item-active" href="integrations.html">
                        <span class="material-symbols-outlined">settings_input_component</span>
                        <span class="text-sm font-medium sidebar-nav-text">統合設定</span>
                    </a>
                    <a class="sidebar-nav-item" href="roadmap.html">
                        <span class="material-symbols-outlined">map</span>
                        <span class="text-sm font-medium sidebar-nav-text">ロードマップ</span>
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- TopNavBar -->
            <header class="page-header">
                <div class="search-container">
                    <div class="search-box">
                        <span class="material-symbols-outlined search-icon">search</span>
                        <input class="search-input" placeholder="設定やリポジトリを検索..." type="text"/>
                    </div>
                </div>
                <div class="flex-row flex-row-gap-md">
                    <button id="finalizeBtn" class="btn btn-primary btn-lg">
                        <span class="material-symbols-outlined text-lg">check_circle</span>
                        <span>ダッシュボードを確定</span>
                    </button>
                </div>
            </header>

            <!-- Scrollable Content -->
            <div class="content-area">
                <!-- Breadcrumbs -->
                <nav class="breadcrumb">
                    <a class="breadcrumb-link" href="index.html">設定</a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current">データ統合・マッピング</span>
                </nav>

                <!-- PageHeading -->
                <div class="page-title">
                    <h2 class="page-title-heading">インポートと設定</h2>
                    <p class="page-title-description">開発ソースとプロダクトロードマップを接続します。カスタムファイルのカラムを内部データ構造にマッピングしてシームレスに同期します。</p>
                </div>

                <!-- Two Column Setup -->
                <div class="grid-2-col-responsive">
                    <!-- GitHub Integration Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-header-content">
                                <div class="card-header-icon card-header-icon-github">
                                    <span class="material-symbols-outlined">terminal</span>
                                </div>
                                <div>
                                    <h3 class="card-header-title">GitHub統合</h3>
                                    <p class="card-header-subtitle">リリースノートのソース</p>
                                </div>
                            </div>
                            <span id="githubStatus" class="status-badge status-badge-disconnected">未接続</span>
                        </div>
                        <div class="card-body">
                            <!-- Connection Type Tabs -->
                            <div class="tab-container">
                                <button type="button" id="tab-api" class="tab-button tab-button-inactive">
                                    API接続
                                </button>
                                <button type="button" id="tab-file" class="tab-button tab-button-active">
                                    ファイル読み込み
                                </button>
                            </div>

                            <!-- API Connection Section -->
                            <div id="api-connection-section" class="section hidden">
                                <div class="form-group">
                                    <label class="form-label">リポジトリURL</label>
                                    <input type="text" id="github-repo-url" class="form-input" placeholder="https://github.com/owner/repo"/>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">パーソナルアクセストークン</label>
                                    <input type="password" id="github-token" class="form-input" placeholder="ghp_xxxxxxxxxxxx"/>
                                    <p class="form-help-text">プライベートリポジトリにアクセスする場合に必要です</p>
                                </div>
                                <button id="test-connection-btn" class="btn btn-primary w-full">
                                    接続をテスト
                                </button>
                            </div>

                            <!-- File Upload Section -->
                            <div id="file-upload-section" class="section">
                                <div class="form-group">
                                    <label class="form-label">プルリクエスト (JSON)</label>
                                    <div id="pr-drop-zone" class="file-drop-zone file-upload-area">
                                        <input type="file" id="pr-file-input" accept=".json" class="hidden"/>
                                        <div class="file-upload-content">
                                            <span class="material-symbols-outlined file-upload-icon">cloud_upload</span>
                                            <p class="file-upload-text">ドラッグ&ドロップまたはクリック</p>
                                            <p class="file-upload-hint" id="pr-file-name">ファイルを選択</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">イシュー (JSON)</label>
                                    <div id="issue-drop-zone" class="file-drop-zone file-upload-area">
                                        <input type="file" id="issue-file-input" accept=".json" class="hidden"/>
                                        <div class="file-upload-content">
                                            <span class="material-symbols-outlined file-upload-icon">cloud_upload</span>
                                            <p class="file-upload-text">ドラッグ&ドロップまたはクリック</p>
                                            <p class="file-upload-hint" id="issue-file-name">ファイルを選択</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="github-files-info" class="file-info-message hidden">
                                    <p>ファイルが読み込まれました</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Excel/CSV Integration Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-header-content">
                                <div class="card-header-icon card-header-icon-roadmap">
                                    <span class="material-symbols-outlined">table_chart</span>
                                </div>
                                <div>
                                    <h3 class="card-header-title">ロードマップインポート</h3>
                                    <p class="card-header-subtitle">Excel/CSVデータマッピング</p>
                                </div>
                            </div>
                            <button id="upload-csv-btn" class="btn btn-accent btn-sm">新規アップロード</button>
                        </div>
                        <div class="card-body">
                            <div id="csv-upload-area" class="file-upload-area">
                                <div id="csv-file-info" class="hidden">
                                    <div class="csv-file-header">
                                        <div class="csv-file-name-row">
                                            <span class="material-symbols-outlined text-accent">description</span>
                                            <span class="csv-file-name" id="csv-file-name">-</span>
                                        </div>
                                        <span class="csv-file-size" id="csv-file-size">-</span>
                                    </div>
                                    <div class="csv-file-info">
                                        <label class="column-mapping-label">カラムマッピング</label>
                                        <div class="grid-2-col" id="column-mapping">
                                            <!-- 動的に生成 -->
                                        </div>
                                    </div>
                                </div>
                                <div id="csv-empty-state" class="empty-state">
                                    <span class="material-symbols-outlined empty-state-icon">upload_file</span>
                                    <p class="empty-state-text">CSVまたはExcelファイルをアップロード</p>
                                    <input type="file" id="csv-file-input" accept=".csv,.xlsx,.xls" class="hidden"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview Section -->
                <div class="preview-section">
                    <div class="preview-header">
                        <h3 class="preview-title">データプレビュー</h3>
                        <div class="preview-info">
                            <span class="preview-indicator"></span>
                            <span class="preview-hint">マッピングに合わせたライブプレビュー</span>
                        </div>
                    </div>
                    <div class="card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ソース</th>
                                    <th>タイトル</th>
                                    <th>ステータス</th>
                                    <th>担当者</th>
                                    <th>リリース予定日</th>
                                </tr>
                            </thead>
                            <tbody id="preview-table-body">
                                <tr>
                                    <td colspan="5" class="data-table-empty">
                                        データをアップロードしてください
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Sticky Footer for Actions -->
            <footer class="page-footer">
                <div class="footer-actions">
                    <button id="reset-btn" class="btn btn-secondary">マッピングをリセット</button>
                    <button id="export-config-btn" class="btn btn-secondary">設定をエクスポート</button>
                </div>
                <div class="flex-row flex-row-gap-lg">
                    <p class="footer-info">すべての変更は自動的にドラフトとして保存されます。</p>
                    <button id="save-btn" class="btn btn-primary btn-lg">
                        <span>保存して統合を確定</span>
                        <span class="material-symbols-outlined text-lg">arrow_forward</span>
                    </button>
                </div>
            </footer>
        </main>
    </div>

    <!-- CSV/Excel解析用ライブラリ -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.full.min.js"></script>
    <script type="module" src="src/js/integrations.js"></script>
</body>
</html>
